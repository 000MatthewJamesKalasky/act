#!/bin/sh

if [  ! -f ./config.in ]
then
	echo "$0: requires a local config.in file"
	exit 1
fi

echo "#ifndef __CONFIG_PKG_H__" > ./_config_pkg.h
echo "#define __CONFIG_PKG_H__" >> ./_config_pkg.h
echo "/*" >> ./_config_pkg.h
echo " Parameters auto-generated by ./configure" >> ./_config_pkg.h
echo "*/" >> ./_config_pkg.h

echo > ./config.mk

for i in `cat config.in`
do
	if $ACT_HOME/scripts/findpkg -i $i >/dev/null
	then
		j=`echo $i | sed s,/,_,g | sed s,-,_,g`
		echo "#define FOUND_$j" >> ./_config_pkg.h
		echo "${j}_INCLUDE=`$ACT_HOME/scripts/findpkg -i $i`" >> ./config.mk
		echo "${j}_LIBDIR=`$ACT_HOME/scripts/findpkg -l $i`" >> ./config.mk
		echo "Package $i: YES"
	else	  
		echo "Package $i: NO"
	fi
done

echo >> ./_config_pkg.h
echo "#endif /* __CONFIG_PKG_H__ */ " >> ./_config_pkg.h


src=_config_pkg.h
dest=config_pkg.h

if [ -r $src ]
then
   if cmp -s $src $dest
   then
        rm $src
   else
        if [ -f $dest ]
        then
                mv $dest ${dest}.old
        fi
        mv $src $dest
   fi
fi
